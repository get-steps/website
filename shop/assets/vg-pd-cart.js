VGTierApp.CartPage.Show_CalculateTier=function(){var e=commonFields_CD.cartItemsCart,r=[],a=0,l=0,t=function(i,t){r=[],a=0,l=0;var o=0;for(commonFields_CD.original_total_price=0,k=0;k<i.length;k++){var d=i[k],u=!0;if(d.original_line_price=d.original_price*d.quantity,d.original_line_price=Number(d.original_line_price.toFixed(2)),""!=d.tiers&&"true"===d.tiers.split(",")[5]&&globalFields.StartEndDateValid(d.tiers.split(","))){var y=c(d.original_price,d.original_line_price,d.quantity,d.tiers.split(","),o,t,!0,k,i,d.variant_id);o=y[0],u=y[1],y[1]&&(o+=d.original_line_price)}else o+=d.original_line_price;u||(a+=d.original_line_price,r.push(d.variant_id)),commonFields_CD.original_total_price+=d.original_line_price}commonFields_CD.original_total_price=Number(commonFields_CD.original_total_price.toFixed(2)),n(t,Number(o.toFixed(2)),commonFields_CD.original_total_price),l=Number((commonFields_CD.original_total_price-o).toFixed(2)),s(t),e=i},c=function(e,r,a,l,t,c,n,s,d,u){var y=0;for(i=6;i<l.length;i++){var p=l[1].split("-")[0],m=l[1].split("-")[1],b=0,F=l[i].split("=")[0],g=l[i].split("=")[1],_=parseInt(F.split("-")[0]),v="max"!=F.split("-")[1]?parseInt(F.split("-")[1]):F.split("-")[1],f=0,x=!1,h=!1;if("product"===p||"collection"===p){var C="product"===p?jQuery.grep(d,function(e){return e.product_id===m}):jQuery.grep(d,function(e){return e.collection_id===m});for(j=0;j<C.length;j++)b+=C[j].quantity;b>=_&&(x=!0),"max"==v?h=!0:b<=v&&(h=!0)}else a>=_&&(x=!0),"max"==v?h=!0:a<=v&&(h=!0);if(x&&h){if(n=!1,"percentage"==l[0].trim()){var S=Number(parseFloat(parseFloat(g)/100*e).toFixed(2));f=Number((e-S).toFixed(2))}else"fixed"==l[0].trim()?f=Number((e-parseFloat(g)).toFixed(2)):"fixed_price"==l[0].trim()&&(f=Number(parseFloat(g).toFixed(2)));f<0&&(f=0),t+=y=Number((f*a).toFixed(2)),o(c,f,y,s,u,e,r,n,d[s].product_id)}}return n&&o(c,e,r,s,u,e,r,n,d[s].product_id),[t,n]},o=function(e,r,i,a,l,t,c,o,n){e&&(o||r==t?(jQuery("#CartPopoverCont .product__price").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span>"),jQuery(".price.item__price").eq(a).html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span>"),jQuery(".mobile-small .item__price--final").eq(a).html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span>")):(jQuery("#CartPopoverCont .product__price").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+'</span> <del><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+t.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+t.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span></del>"),jQuery(".price.item__price").eq(a).html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+'</span> <del><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+t.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+t.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span></del>"),jQuery(".mobile-small .item__price--final").eq(a).html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+'</span> <del><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+t.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+t.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span></del>")))},n=function(e,r,i){e&&(i!=r?(jQuery(".cart__subtotal").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+'</span> <s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+i.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+i.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span></s>"),jQuery(".totals-content .price").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+'</span> <s><span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+i.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+i.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span></s>")):(jQuery(".cart__subtotal").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span>"),jQuery(".totals-content .price").html('<span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+r.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+r.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span>")))},s=function(e){if(l>0&&e&&globalFields.isCartPage){var r='<h3 id="saved-banner">'+jQuery("#vg-saving-message").text()+' <span class="money" data-currency-'+globalFields.currency.toLowerCase()+'="'+globalFields.currencySymbol+l.toFixed(2)+'" data-currency="'+globalFields.currency+'">'+l.toFixed(2).replace(".",",")+globalFields.currencySymbol+"</span></h3>";0==jQuery("#saved-banner-div").length?jQuery('form[action="/cart"]').before('<div id="saved-banner-div" class="col-md-14">'+r+"</div>"):jQuery("#saved-banner-div").html(r)}else globalFields.isCartPage&&jQuery("#saved-banner-div").remove()},d=function(){jQuery('form[action="/cart"] input[name="checkout"]').click(function(){jQuery('[name="updates[]"]').each(function(){var r=this.value,a=jQuery(this).attr("id");for(a=(a=a.split("_"))[1],i=0;i<e.length;i++)e[i].variant_id==Number(a)&&(e[i].quantity=Number(r))}),t(e,!1),y(!1)})},u=function(){jQuery('a[href="/checkout"].btn.btn--primary').click(function(e){e.preventDefault(),y(!0)})},y=function(e){l>0?$.ajax({type:"POST",async:!1,url:"https://www.vgroupapps.com/TieredPricing/api/services/GetCode",data:{priceDifference:l,subTotal:a,variantIds:r.toString()},success:function(r){var i=JSON.stringify(r),a=JSON.parse(i),l=a.PRID,t=a.DCID,c=a.DiscountCode;!function(e,r,i){var a=new Date;a.setTime(a.getTime()+24*i*60*60*1e3);var l="expires="+a.toUTCString();document.cookie=e+"="+r+";"+l+";path=/"}("discountCodes",l+"-"+t+"-"+c,30),e?(p(c),window.location.href="/checkout?discount="+c):(p(c),jQuery('form[action="/cart"]').append('<input id="discount_input" type="hidden" name="discount" value="'+c+'">'))},error:function(e){console.log(e.statusText)}}):e&&(window.location.href="/checkout")},p=function(e){$.ajax({type:"HEAD",url:"/discount/"+e,success:function(e){},error:function(e){console.log(e.statusText)}})},m=function(e,r){var i="";return commonFields_CD.variantsMFArray.hasOwnProperty(r)?i=commonFields_CD.variantsMFArray[r]:globalFields.isProductPage&&commonFields_PD.variantsMFArray_PD.hasOwnProperty(r)?i=commonFields_PD.variantsMFArray_PD[r]:jQuery.ajax({async:!1,url:"/products/"+e+"?view=vgmetafields",success:function(e){for(var a=JSON.parse(e),l=0;l<a.length;l++){var t=a[l];if(t.variantId===r){t.tiers.hasOwnProperty("tieredpricing")&&(i=t.tiers.tieredpricing);break}}},error:function(e){console.log(e.statusText)}}),i};jQuery(document).ajaxComplete(function(r,a,l){!function(r,a){if("undefined"!=r&&""!=r&&null!=r&&("/cart.js"==(r=r.split("?"))[0]||"/cart/change.js"==r[0]||"/cart/add.js"===r[0]))if("/cart/add.js"!=r[0]){var l=JSON.parse(a);setTimeout(function(){var r=e;e=[],commonFields_CD.original_total_price=Number((l.original_total_price/100).toFixed(2));for(var i=0;i<l.items.length;i++){var a=l.items[i],c=Number((a.original_price/100).toFixed(2)),o=Number((a.original_line_price/100).toFixed(2)),n=jQuery.grep(r,function(e){return e.variant_id===a.variant_id}),s=0!=n.length?n[0].tiers:m(a.handle,a.variant_id),y=""!=s&&"collection"===s.split(",")[1].split("-")[0]?s.split(",")[1].split("-")[1]:0,p={variant_id:a.variant_id,tiers:s,original_price:c,original_line_price:o,quantity:a.quantity,product_id:a.product_id.toString(),collection_id:y};e.push(p)}t(e,!0),d(),jQuery(".mb_cart.mb_item button.btn, .top-header .dropdown-cart button.btn").off("click"),u()},1500)}else{var c=JSON.parse(a);setTimeout(function(){var r=!1;for(i=0;i<e.length;i++)e[i].variant_id==c.variant_id&&(e[i].quantity=Number(c.quantity),r=!0,t(e,!0),d(),u());if(!r){var a=Number((c.original_price/100).toFixed(2)),l=Number((c.original_line_price/100).toFixed(2)),o=jQuery.grep(e,function(e){return e.variant_id===c.variant_id}),n=0!=o.length?o[0].tiers:m(c.handle,c.variant_id),s=""!=n&&"collection"===n.split(",")[1].split("-")[0]?n.split(",")[1].split("-")[1]:0,y={variant_id:c.variant_id,tiers:n,original_price:a,original_line_price:l,quantity:c.quantity,product_id:c.product_id.toString(),collection_id:s};e.push(y)}var p=setInterval(function(){0!==$(".product__add__success__content").length&&(clearInterval(p),t(e,!0),d(),u())},100)},1e3)}}(l.url,a.responseText)}),t(e,!0),d(),u()};var commonFields_CD=new VGTierApp.CartPage.Global,cartObject=new VGTierApp.CartPage.Show_CalculateTier;